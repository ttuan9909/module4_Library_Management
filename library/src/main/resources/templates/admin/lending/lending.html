<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Library - Borrow Books</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/ad-lending.css}">
</head>
<body>

<!-- Sidebar -->
<div th:replace="admin/fragment/sidebar :: sidebar"></div>

<!-- Main content -->
<div class="main-content">
    <div class="page-header mb-4 d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Borrow Books</h5>
        <button class="btn btn-primary">
            <i></i> Save
        </button>
    </div>

    <!-- Content: 2 panels side by side -->
    <div class="content-area row g-4">
        <!-- Reader Panel -->
        <div class="col-md-4">
            <div class="reader-panel">
                <h6 class="mb-3">Reader Information</h6>

                <div class="input-group mb-3">
                    <input id="readerSelectInput" type="text" class="form-control" placeholder="Enter User ID or Phone Number">
                    <button class="btn btn-primary" onclick="selectReader()">Select</button>
                </div>

                <div id="userInfo" class="mt-3" style="display:none;">
                    <ul class="list-group">
                        <li class="list-group-item"><strong>Full Name:</strong> <span id="uFullName"></span></li>
                        <li class="list-group-item"><strong>Email:</strong> <span id="uEmail"></span></li>
                        <li class="list-group-item"><strong>Phone:</strong> <span id="uPhone"></span></li>
                        <li class="list-group-item"><strong>Status:</strong> <span id="uStatus"></span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Book Selection Panel -->
        <div class="col-md-8">
            <div class="book-panel">
                <h6 class="mb-3">Select Books to Borrow</h6>

                <!-- Select book -->
                <div class="input-group mb-2">
                    <input id="bookSelectInput" type="text" class="form-control" placeholder="Enter Book ID or Title" onkeyup="showSuggestions(this.value)">
                    <button class="btn btn-primary" onclick="selectBook()">Select</button>
                </div>

                <!-- Autocomplete suggestions -->
                <div id="bookSuggestions" class="suggestions d-none"></div>

                <!-- Selected book result -->
                <div id="bookResult" class="alert alert-info d-none mt-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <span id="bookTitle"></span>
                        <button class="btn btn-sm btn-success" onclick="addBook()">Add</button>
                    </div>
                </div>

                <!-- Selected books -->
                <h6 class="mt-4">Selected Books</h6>
                <table class="table table-hover align-middle" id="selectedBooksTable">
                    <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Book Title</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Dynamic rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    async function selectReader() {
        const input = document.getElementById('readerSelectInput').value.trim();
        if (!input) {
            alert("Please enter User ID, phone number or email!");
            return;
        }

        try {
            const response = await fetch(`/user/find-user?search=${encodeURIComponent(input)}`);
            if (!response.ok) throw new Error("User not found");

            const user = await response.json();

            // Hiển thị thông tin người dùng
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('uFullName').textContent = user.fullName;
            document.getElementById('uEmail').textContent = user.email || 'N/A';
            document.getElementById('uPhone').textContent = user.phoneNumber || 'N/A';
            document.getElementById('uStatus').textContent = user.status;

        } catch (error) {
            document.getElementById('userInfo').style.display = 'none';
            alert("User not found!");
        }
    }
</script>
